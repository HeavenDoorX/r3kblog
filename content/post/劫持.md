---
title: "一文看懂劫持与反劫持"
date: 2021-09-07
author: "R3K安全团队"
tags: ["安全", "反劫持"]
categories: ["中文"]
---
>2002年9月，传奇游戏从意大利服务器端的源代码意外泄露开始，流入中国，sf就开始萌芽了，19年间，各种游戏资源、引擎更新换代，当年无数的传奇爱好者涌入私服搭建的队伍。由于私服的特殊属性，DDoS、登陆器劫持、网站劫持等所谓黑吃黑的现象层出不穷，更有甚者为了利益买通网管拔网线的事情也是比比皆是。

本文在这里尽量以大家能看明白的方式讲讲劫持这件事情。

根据R3K团队采集来的劫持程序样本来看，可以分作三大类：

- 供应链劫持
- 本地劫持
- 流量劫持（流量层劫持好防御本文不做过多讨论）



### 1.供应链劫持



传奇IP生态供应链丰富多样，后援技术力量十分强大，一个新手小白也能非常快的把游戏搭建起来，但是这也给劫持提供了十分便捷的途径。任何插件、工具、登陆器、封装盾，理论上都有能力去做劫持。

那如何去避免呢？

当然是使用可信的供应链，比如`GOM`的`GK`、以及各引擎官方供应的东西。尽量避免使用【匿名】运营的登陆器和插件。除了招聘技术团队全套自行开发以外，或者开源审核过的组件，没有100%能避免供应链劫持的办法。

目前根据团队分析，`GOM`生态下的产品比较混乱，所以不建议小白gm采用`GOM`引擎，具体有问题的插件/登陆器这里就不一一点名了，多向老gm取经。



### 2.本地劫持



顾名思义，这是玩家电脑端感染了mir2劫持程序，这是非常有针对性的劫持程序，多存在于网吧和未装杀软的电脑中。当然，绝大部分，装个杀软就能解决。玩家电脑的感染源主要来源于被供应链感染的登陆器（这里不排除gm自己投毒的可能性）、辅助\外挂程序等等。

这里着重讲解一下如何在用户机被劫持感染、且无杀软的解决方式。

首先我们先了解下本地劫持的原理，本地劫持的方法大致分为种：



#### 1.登陆器文件修改替换

直接替换exe文件的比较少见，一般是通过图标&可执行文件名称&下载源进行匹配，在文件落地的时候将exe替换成劫持程序希望用户打开的程序，或者通过进程注入恶意代码，直接修改游戏数据。

**_解决方式：登陆器改名、改图标_**



#### 2.dns解析劫持

dns劫持是最常见的劫持手段.因为维护成本比较低，通常劫持作者会去游戏发布站自动爬取游戏的`官网链接`，将发布站上的广告地址列入dns劫持的名单。做的比较深的劫持会打开你的登陆器分析列表地址，将`列表地址`拉入劫持名单。很多gm会发现玩家反馈网址打开后被劫持到了不知名的发布站。

{{% admonition type="tip" title="常见解决方案" %}}
1. 网站换不常用端口（sample.com:8086），缺点：还是会被劫持，被劫持后展示空白页

2. 域名使用ssl，缺点：劫持后用户会展示证书风险，点击信任和依旧可以访问

3. 域名换ip+端口，缺点：由于没有使用ssl协议，部分劫持程序仍旧支持修改

4. 频繁更换域名，缺点：劫持是自动抓取链接（主要是发布站），如果上广告，就会被劫持
{{% /admonition %}}

终极解决方案：ip+ssl(https://8.8.8.8) 缺点：需要购买高防ip和ip证书才可以生效



### R3K建议

劫持程序常规操作是从发布站获取劫持目标，将劫持域名丢进宿主机hosts或者pac文件中

1. 真实域名做多级跳转，发布站上跳转域名，随时更换，劫持的爬虫脚本深度一般不会到3层

2. 域名ssl还是要用的，特别是登陆器列表地址，网上很多免费域名ssl证书可以申请

3. 可以使用微信公众号等社交页面上发布站，在公众号文章中放网站链接，一般劫持程序为了防止劫持机掉线（装杀软查杀），不会去劫持常用网站域名。一般来说，社交网站都是会放进劫持列表白名单的，根据这个思路可以自行发挥你的想象。

**有条件的朋友，最好使用ip+ssl的方案。**

写在最后：所有侵犯版权，无版号，无网文的游戏运营都是非常严重的违法行为